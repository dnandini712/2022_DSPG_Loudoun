---
title: "Com. Schools Race Demographics"
author: "Amanda E. Ljuba"
date: '2022-06-14'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyverse)
races <- read_excel("~/Downloads/DSPG-R-Training/2022_DSPG_Loudoun/shinyapp/data/racedems.xlsx")
race_subset <- races[(1:153),c(1,5,6,7)]
```

```{r}
School <- race_subset$`School Name`
race <- race_subset$Race
total <- race_subset$`Full Time Count (All Grades)`
ggplot(race_subset,aes(x=race,y=total,fill=School))+ geom_col()+labs(title="Race/Ethnicity of Community Schools",subtitle="2016 to 2020 school years",x="Race/Ethnicity",y="Number of Students",caption = "Source: VDOE Fall Membership Report 2016-2020") + theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 1)) + scale_fill_brewer(palette = "Set1")

```
Across all 6 community schools, the race/ethnicity of Hispanic significantly makes up the largest proportion of students with White and Asian students as the next largest groups. Notably, there was not enough students of both American Indian and Pacific Islander ethnicity to be represented in the data.

```{r}
ggplotly(raceehtn)
```


```{r}
library(plotly)
race_subset %>% count("race","School","total")  %>% plot_ly(x =~race, y =~total,color=~race)%>%  add_bars()%>%  layout(barmode ="stack") %>% layout(xaxis = list(title = ''),
         yaxis = list(title = 'Number of Students'),legend=list(title=list(text='')))
```




x shift and y shift in annotation 


```{r}
School <- race_subset$`School Name`
race <- race_subset$Race
Total <- race_subset$`Full Time Count (All Grades)`
year <- race_subset$`School Year`
raceehtn <- ggplot(race_subset,aes(x=race,y=Total,fill=School))+ geom_col()+labs(title="Race/Ethnicity of Community Schools",subtitle="2016 to 2020 school years",x="Race/Ethnicity",y="Number of Students",caption = "Source: VDOE Fall Membership Report 2016-2020") + theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 1)) + scale_fill_brewer(palette = "Set1")
```





```{r}
library(plotly)
library(gganimate)
install.packages("gifski")
library(gifski)
race_subset %>% count("race","School","total")  %>% plot_ly(x =~race, y =~total,color=~race)%>%  add_bars()%>%  layout(barmode ="stack") %>% layout(xaxis = list(title = ''),
         yaxis = list(title = 'Number of Students'),legend=list(title=list(text='')))
```

```{r}
races <- read_excel("~/Downloads/DSPG-R-Training/2022_DSPG_Loudoun/shinyapp/data/racedems.xlsx")
race_subset <- races[(1:96),c(1,5,6,9)]
School <- race_subset$`School Name`
race <- race_subset$Race
Total <- race_subset$`Total Count`
as.numeric(race_subset$`School Year`)
year <- race_subset$`School Year`

timerace <- ggplot(race_subset,aes(x=School,y=Total,fill=factor(race, levels=c("Hispanic","Black, not of Hispanic origin","White, not of Hispanic origin","Asian" )))) + geom_col(stat='identity', text = paste0("Year: ",year, "<br>","School:",School, "<br>","Race:",race, "<br>","Total:",total ))+guides(fill = guide_legend(title = "Race/Ethnicity")) + labs(title = "Race/Ethnicity Composition of Students",x = "", y = "Total",caption = "Source: VDOE Fall Membership Report 2016-2020",subtitle = "Year: {as.integer(frame_time)}")+ scale_fill_discrete(breaks=c("Hispanic","Black, not of Hispanic origin","White, not of Hispanic origin","Asian")) + transition_time(year,range = c(2016,2019))

ggplotly(timerace, tooltip = c("Year: ", year, "<br>","School:",School, "<br>","Race:",race, "<br>","Total:",total))

#animate(timerace, renderer = gifski_renderer())
```


```{r}
School <- race_subset$`School Name`
race <- race_subset$Race
Total <- race_subset$`Total Count`
as.numeric(race_subset$`School Year`)
year <- race_subset$`School Year`

plot_ly(race_subset,x = ~School, y = ~Total, color = ~race, type = "bar",barmode = "stack", hoverinfo = "text",text = ~paste("School:",School,"<br>","Total:",Total,"<br>","Year:", year)) %>% layout(title="Race/Ethnicity Composition of Students",legend = list(title = list(text="Select Race")))
```



#ignore everything below this
```{r}
yearone <- race_subset[c(1:6, 25:30, 49:54, 73:78),]
yeartwo <- race_subset[c(7:12, 31:36,55:60,79:84),]
yearthree <- race_subset[c(13:18, 37:42, 61:66, 85:90),]
yearfour <- race_subset[c(19:24, 43:48,67:72,91:96),]
School1 <- yearone$`School Name`
race1 <- yearone$Race
total1 <- yearone$`Total Count`
year1 <- yearone$`School Year`
School2 <- yeartwo$`School Name`
race2 <- yeartwo$Race
total2 <- yeartwo$`Total Count`
year2 <- yeartwo$`School Year`
School3 <- yeartwo$`School Name`
race3 <- yeartwo$Race
total3 <- yeartwo$`Total Count`
year3 <- yeartwo$`School Year`
School4 <- yeartwo$`School Name`
race4 <- yeartwo$Race
total4 <- yeartwo$`Total Count`
year4 <- yeartwo$`School Year`
```

```{r}
sixteen <- ggplot(yearone,aes(x=School1,y=total1,fill=race1)) + geom_col()+guides(fill = guide_legend(title = "Race/Ethnicity")) + labs(title = "Race/Ethnicity Composition of Students",x = "", y = "Total",caption = "Source: VDOE Fall Membership Report 2016-2020")

seventeen <- ggplot(yeartwo,aes(x=School2,y=total2,fill=race2)) + geom_col()+guides(fill = guide_legend(title = "Race/Ethnicity")) + labs(title = "Race/Ethnicity Composition of Students",x = "", y = "Total",caption = "Source: VDOE Fall Membership Report 2016-2020")

eightteen <- ggplot(yearthree,aes(x=School3,y=total3,fill=race3)) + geom_col()+guides(fill = guide_legend(title = "Race/Ethnicity")) + labs(title = "Race/Ethnicity Composition of Students",x = "", y = "Total",caption = "Source: VDOE Fall Membership Report 2016-2020")

nineteen <- ggplot(yearfour,aes(x=School4,y=total4,fill=race4)) + geom_col()+guides(fill = guide_legend(title = "Race/Ethnicity")) + labs(title = "Race/Ethnicity Composition of Students",x = "", y = "Total",caption = "Source: VDOE Fall Membership Report 2016-2020")
```


```{r}
install.packages("gganimate")
library(gganimate)

```



#forest grove
```{r}
forestgrove <- races[c(1,7,13,19,25,31,37,43,49,55,61,67,73,79,85,91,97,103,109,115),c(1,5,6,7)]
year <- forestgrove$`School Year`
race <- forestgrove$Race
Total <- forestgrove$`Full Time Count (All Grades)`

plot_ly(forestgrove,x=~year,y=~Total,color=~race,type = 'scatter', mode = 'lines',hoverinfo = "text",text = ~paste("Year:",year,"<br>","Total:",Total)) %>% layout(title = "Race/Ethnicity Composition of Students",xaxis = list(title = ""))
```

#guilford
```{r}
guildford <- races[c(2,8,14,20,26,32,38,44,50,56,62,68,74,80,86,92,98,104,110,116),c(1,5,6,7)]
year <- guildford$`School Year`
Total <- guildford$`Full Time Count (All Grades)`
race <- guildford$Race


plot_ly(forestgrove,x=~year,y=~Total,color=~race,type = 'scatter', mode = 'lines',hoverinfo = "text",text = ~paste("Year:",year,"<br>","Total:",Total)) %>% layout(title = "Race/Ethnicity Composition of Students",xaxis = list(title = ""))
```

#rolling ridge
```{r}
rollingridge <- races[c(3,9,15,21,27,33,39,45,51,57,63,75,81,87,93,99,105,111,117),c(1,5,6,7)]
year <- rollingridge$`School Year`
Total <- rollingridge$`Full Time Count (All Grades)`
race <- rollingridge$Race

plot_ly(forestgrove,x=~year,y=~Total,color=~race,type = 'scatter', mode = 'lines',hoverinfo = "text",text = ~paste("Year:",year,"<br>","Total:",Total)) %>% layout(title = "Race/Ethnicity Composition of Students",xaxis = list(title = ""))
```

#sterling
```{r}
sterling <- races[c(4,10,16,22,28,34,40,46,52,58,64,70,76,82,88,94,100,106,112,118),c(1,5,6,7)]
year <- sterling$`School Year`
race <- sterling$Race
Total <- sterling$`Full Time Count (All Grades)`

plot_ly(forestgrove,x=~year,y=~Total,color=~race,type = 'scatter', mode = 'lines',hoverinfo = "text",text = ~paste("Year:",year,"<br>","Total:",Total)) %>% layout(title = "Race/Ethnicity Composition of Students",xaxis = list(title = ""))
```

#sugarland
```{r}
sugarland <- races[c(5,11,17,23,29,35,41,47,53,59,65,71,77,83,89,95,101,107,113,119),c(1,5,6,7)]
year <- sugarland$`School Year`
race <- sugarland$Race
Total <- sugarland$`Full Time Count (All Grades)`

plot_ly(forestgrove,x=~year,y=~Total,color=~race,type = 'scatter', mode = 'lines',hoverinfo = "text",text = ~paste("Year:",year,"<br>","Total:",Total)) %>% layout(title = "Race/Ethnicity Composition of Students",xaxis = list(title = ""))
```

#sully
```{r}
sully <- races[c(6,12,18,24,30,36,42,48,54,60,66,72,78,84,90,96,102,108,114,120),c(1,5,6,7)]
year <- sully$`School Year`
Total <- sully$`Full Time Count (All Grades)`
race <- sully$Race

plot_ly(forestgrove,x=~year,y=~Total,color=~race,type = 'scatter', mode = 'lines',hoverinfo = "text",text = ~paste("Year:",year,"<br>","Total:",Total)) %>% layout(title = "Race/Ethnicity Composition of Students",xaxis = list(title = ""))
```

