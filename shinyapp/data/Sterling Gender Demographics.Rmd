---
title: "loudoun research 2.0"
author: "NDP"
date: '2022-06-09'
output: html_document
---

```{r set_up_API, }
readRenviron("~/.Renviron") #readin Census API key
Sys.getenv("CENSUS_API_KEY") #confirm you have read in your Census API key
```

```{r}
library(tidycensus)
# Set a year of interest
this.year = 2020

# This looks at the 5 year estimates
# You can also do "acs1"
vars <- load_variables(year = 2019,
                      dataset = "acs5",
                      cache = TRUE)
```

# Sterling Gender Demographic
```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(tidycensus)

sterling <- read_excel(paste0(getwd(), "/sterlingdata.xlsx"),skip=1,col_names=TRUE)
subset_sterling <- sterling[3:4,c(1,6:7)]


gender_estimate <- subset_sterling$Estimate...6
as.numeric(gsub(",","",gender_estimate))
gender_estimate <-as.numeric(gsub(",","",gender_estimate))
gender_cat <- (subset_sterling$Label)

ggplot(subset_sterling,aes(x=gender_cat,y=gender_estimate,fill=gender_cat))+geom_col()+theme(axis.text.x=element_text(face="bold"))+scale_x_discrete(limits=gender_cat)+labs(title="Gender Population",caption= "Source: DP05 ACS data 2016-2020",x="Gender",y="Population") + guides(fill = guide_legend(title = "Gender"))
```
This demographic displays a bar graph of the gender demographics in Sterling,VA. The two gender in the legend are male and female. The male demographic is represented by the blue grapgh and the female demographic is represented by the pink graph. Males make up 50.5% of the population in Sterling,VA. That means out of the 30,271 individuals in Sterling,VA, 15,282 of them are males. Females make up 49.4% of the population in Sterling,VA. That means out of the 30,721 individuals in Sterling,VA, 14,989 of them are female


#Variable codes
```{r}
va20_S <- get_acs(geography = "place",
variables = c(Males = "B01001_002",
Females = "B01001_026", 
Gender = "B01001_001",
whiteM = "B01001A_002",
whiteF = "B01001A_017",
af.amM = "B01001B_002",
af.amF = "B01001B_017",
asianM = "B01001D_002",
asianF = "B01001D_017",
hispanicM = "B01001I_002",
hispanicF = "B01001I_017"),
state = "VA", year = 2020,
geometry = TRUE) %>%
filter(NAME == "Sterling CDP, Virginia")
```

#Specific Demographic Gender
```{r}
male <- filter(va20_S,variable=="Males")
female <- filter(va20_S,variable=="Females")
whiteM <- filter(va20_S,variable=="whiteM")
whiteF <- filter(va20_S,variable=="whiteF")
af.amM <- filter(va20_S,variable=="af.amM")
af.amF <- filter(va20_S,variable=="af.amF")
asianM <- filter(va20_S,variable=="asianM")
asianF <- filter(va20_S,variable=="asianF")
hispanicM <- filter(va20_S,variable=="hispanicM")
hispanicF <- filter(va20_S,variable=="hispanicF")
```

#Better Map Visualization of Males in Sterling,VA
```{r}
#specify the bin breaks
mybinsM <- c(0,500,1000,1500,2000,2500,3000)
#specify the default color
mypaletteM <- colorBin(palette="inferno", domain=vaMale$estimate, na.color="transparent", bins=mybinsM)

leaflet(data = vaMale) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~mypaletteM(vaMale$`estimate`),
    stroke=TRUE,
    weight = 1,
    smoothFactor = 0.2,
    opacity = 1.0,
    fillOpacity = 0.7, 
    label=paste("County: ",vaMale$GEOID, ", Value: ",vaMale$estimate),
    highlightOptions = highlightOptions(color = "white",
                                        weight = 2,
                                        bringToFront = TRUE)) %>%
  addLegend(pal=mypaletteM, position = "bottomright",
            values = ~vaMale$estimate,
            opacity = 0.5, title = "Male Population In Sterling,VA") %>%
  addPolylines(data = vaMale, color = "black", 
               opacity = 0.2, weight = 1)

```
Here is a map visualization of the male population in Sterling,VA. I used the 2020 census block map to map out Sterling, and from there, used the ACS data to locate the number of individuals in each block/area who identify as a male.


#Better Map Visualization of Females in Sterling,VA
```{r}
#specify the bin breaks
mybinsF <- c(0,500,1000,1500,2000,2500,3000)
#specify the default color
mypaletteF <- colorBin(palette="inferno", domain=vaFemale$estimate, na.color="transparent", bins=mybinsF)

leaflet(data = vaFemale) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~mypaletteF(vaFemale$`estimate`),
    stroke=TRUE,
    weight = 1,
    smoothFactor = 0.2,
    opacity = 1.0,
    fillOpacity = 0.7, 
    label=paste("County: ",vaFemale$GEOID, ", Value: ",vaFemale$estimate),
    highlightOptions = highlightOptions(color = "white",
                                        weight = 2,
                                        bringToFront = TRUE)) %>%
  addLegend(pal=mypaletteF, position = "bottomright",
            values = ~vaFemale$estimate,
            opacity = 0.5, title = "Female Population In Sterling,VA") %>%
  addPolylines(data = vaFemale, color = "black", 
               opacity = 0.2, weight = 1)

```
Here is a map visualization of the female population in Sterling,VA. I used the 2020 census block map to map out Sterling, and from there, used the ACS data to locate the number of individuals in each block/area who identify as a female.

#Gender Pie Chart
```{r}
library(plotly)

labelsG = c("Male", "Female")
valuesG = c(15282, 14989)

figG <- plot_ly(type='pie', labels=labelsG, values=valuesG, 
               textinfo='label+percent',
               insidetextorientation='radial', marker = list(colors = c('20AFCC', 'F56D4F'))) %>% layout(title ='', legend=list(title=list(text='')))

figG
```

This demographic displays a pie chart of the gender demographics in Sterling,VA. The two gender in the legend are male and female. The male demographic is represented by the red half and the female demographic is represented by the light blue half. Males make up 50.5% of the population in Sterling,VA. That means out of the 30,271 individuals in Sterling,VA, 15,282 of them are males. Females make up 49.4% of the population in Sterling,VA. That means out of the 30,721 individuals in Sterling,VA, 14,989 of them are female








